{% extends "base.html" %}

{% block title %}Task Management - AI Chief of Staff{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-0">
            <i class="fas fa-tasks me-2"></i>
            Enhanced Task Management
        </h1>
        <p class="text-muted mb-0">Manage tasks with entity relationships and intelligent workflows</p>
    </div>
    <div>
        <button class="btn btn-enhanced" onclick="openAddTaskModal()">
            <i class="fas fa-plus me-2"></i>New Task
        </button>
        <button class="btn btn-outline-info ms-2" onclick="generateTasksFromEmails()">
            <i class="fas fa-envelope me-2"></i>From Emails
        </button>
    </div>
</div>

<!-- Task Statistics -->
<div class="row mb-4">
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-value" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-tasks fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-value" id="pendingTasks">0</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-clock fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-value" id="completedTasks">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-check-circle fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-value" id="overdueTasks">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-exclamation-triangle fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filters and View Controls -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label for="searchTasks" class="form-label">Search Tasks</label>
                        <div class="input-group">
                            <input type="text" id="searchTasks" class="form-control" placeholder="Search tasks..." onkeyup="filterTasks()">
                            <button class="btn btn-outline-primary" onclick="filterTasks()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="statusFilter" class="form-label">Status</label>
                        <select id="statusFilter" class="form-select" onchange="filterTasks()">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="priorityFilter" class="form-label">Priority</label>
                        <select id="priorityFilter" class="form-select" onchange="filterTasks()">
                            <option value="">All Priority</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="dueDateFilter" class="form-label">Due Date</label>
                        <select id="dueDateFilter" class="form-select" onchange="filterTasks()">
                            <option value="">All Dates</option>
                            <option value="today">Today</option>
                            <option value="this_week">This Week</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="viewMode" class="form-label">View</label>
                        <select id="viewMode" class="form-select" onchange="changeViewMode()">
                            <option value="list">List View</option>
                            <option value="kanban">Kanban Board</option>
                            <option value="calendar">Calendar View</option>
                        </select>
                    </div>
                    <div class="col-md-1 mb-3">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-grid">
                            <button class="btn btn-outline-secondary" onclick="clearFilters()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tasks Display -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list me-2"></i>Tasks
                </h5>
                <div>
                    <button class="btn btn-sm btn-outline-secondary me-2" onclick="bulkActions()">
                        <i class="fas fa-check-square me-2"></i>Bulk Actions
                    </button>
                    <button class="btn btn-sm btn-outline-info" onclick="exportTasks()">
                        <i class="fas fa-download me-2"></i>Export
                    </button>
                </div>
            </div>
            <div class="card-body">
                <!-- List View -->
                <div id="listView">
                    <div id="tasksContainer">
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-tasks fa-3x mb-3"></i>
                            <p>Loading tasks...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Kanban View -->
                <div id="kanbanView" style="display: none;">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="kanban-column" data-status="pending">
                                <h6 class="kanban-header bg-warning">Pending</h6>
                                <div class="kanban-tasks" id="pending-tasks"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kanban-column" data-status="in_progress">
                                <h6 class="kanban-header bg-info">In Progress</h6>
                                <div class="kanban-tasks" id="in_progress-tasks"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kanban-column" data-status="completed">
                                <h6 class="kanban-header bg-success">Completed</h6>
                                <div class="kanban-tasks" id="completed-tasks"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kanban-column" data-status="cancelled">
                                <h6 class="kanban-header bg-secondary">Cancelled</h6>
                                <div class="kanban-tasks" id="cancelled-tasks"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar View Placeholder -->
                <div id="calendarView" style="display: none;">
                    <div id="taskCalendar"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Task Modal -->
<div class="modal fade" id="taskModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="taskModalTitle">
                    <i class="fas fa-plus me-2"></i>Add New Task
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="taskId" value="">
                    
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="taskDescription" class="form-label">Task Description *</label>
                            <textarea class="form-control" id="taskDescription" rows="2" required placeholder="Describe what needs to be done..."></textarea>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="taskPriority" class="form-label">Priority</label>
                            <select class="form-select" id="taskPriority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="taskStatus" class="form-label">Status</label>
                            <select class="form-select" id="taskStatus">
                                <option value="pending" selected>Pending</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="taskDueDate" class="form-label">Due Date</label>
                            <input type="datetime-local" class="form-control" id="taskDueDate">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="taskEstimatedTime" class="form-label">Estimated Time (hours)</label>
                            <input type="number" class="form-control" id="taskEstimatedTime" step="0.5" min="0">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="relatedPeople" class="form-label">Related People</label>
                            <select class="form-select" id="relatedPeople" multiple>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="relatedTopics" class="form-label">Related Topics</label>
                            <select class="form-select" id="relatedTopics" multiple>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="taskNotes" class="form-label">Notes</label>
                        <textarea class="form-control" id="taskNotes" rows="3" placeholder="Additional notes or context..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-enhanced" onclick="saveTask()">
                    <i class="fas fa-save me-2"></i>Save Task
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .task-item {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.5rem;
        background: white;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .task-item:hover {
        border-color: var(--primary-color);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .task-item.high-priority {
        border-left: 4px solid var(--accent-color);
    }
    
    .task-item.medium-priority {
        border-left: 4px solid var(--warning-color);
    }
    
    .task-item.low-priority {
        border-left: 4px solid var(--info-color);
    }
    
    .task-item.overdue {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    }
    
    .kanban-column {
        background: #f8f9fa;
        border-radius: 8px;
        min-height: 500px;
    }
    
    .kanban-header {
        color: white;
        padding: 0.75rem;
        border-radius: 8px 8px 0 0;
        text-align: center;
        font-weight: bold;
    }
    
    .kanban-tasks {
        padding: 1rem;
    }
    
    .kanban-task {
        background: white;
        border-radius: 6px;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        cursor: move;
        border: 1px solid #dee2e6;
        transition: all 0.3s;
    }
    
    .kanban-task:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .priority-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-weight: bold;
    }
    
    .entity-tag {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        margin: 0.1rem;
        display: inline-block;
    }
    
    .progress-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 0.5rem;
    }
    
    .status-pending { background-color: var(--warning-color); }
    .status-in_progress { background-color: var(--info-color); }
    .status-completed { background-color: var(--success-color); }
    .status-cancelled { background-color: var(--secondary); }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Task management functionality
    let currentTasks = [];
    let filteredTasks = [];
    let currentViewMode = 'list';
    let currentEditingTask = null;
    let people = [];
    let topics = [];
    
    // Initialize task management
    document.addEventListener('DOMContentLoaded', function() {
        loadTasks();
        loadPeopleAndTopics();
    });
    
    // Load tasks
    async function loadTasks() {
        try {
            showLoading();
            const response = await axios.get('/api/entities/tasks', {
                params: {
                    limit: 1000,
                    include_relationships: true
                }
            });
            
            hideLoading();
            
            if (response.data.success) {
                currentTasks = response.data.data.tasks || [];
                filteredTasks = [...currentTasks];
                updateTaskStatistics();
                renderTasks();
            } else {
                showAlert('Failed to load tasks: ' + response.data.error, 'danger');
            }
        } catch (error) {
            hideLoading();
            showAlert('Error loading tasks: ' + error.message, 'danger');
        }
    }
    
    // Load people and topics for relationships
    async function loadPeopleAndTopics() {
        try {
            const [peopleResponse, topicsResponse] = await Promise.all([
                axios.get('/api/people', { params: { limit: 500 } }),
                axios.get('/api/entities/topics', { params: { limit: 500 } })
            ]);
            
            if (peopleResponse.data.success) {
                people = peopleResponse.data.people || [];
                populatePeopleSelect();
            }
            
            if (topicsResponse.data.success) {
                topics = topicsResponse.data.data.topics || [];
                populateTopicsSelect();
            }
        } catch (error) {
            console.error('Error loading people/topics:', error);
        }
    }
    
    // Update task statistics
    function updateTaskStatistics() {
        const stats = {
            total: currentTasks.length,
            pending: currentTasks.filter(t => t.status === 'pending').length,
            completed: currentTasks.filter(t => t.status === 'completed').length,
            overdue: currentTasks.filter(t => isTaskOverdue(t)).length
        };
        
        document.getElementById('totalTasks').textContent = stats.total;
        document.getElementById('pendingTasks').textContent = stats.pending;
        document.getElementById('completedTasks').textContent = stats.completed;
        document.getElementById('overdueTasks').textContent = stats.overdue;
    }
    
    // Filter tasks
    function filterTasks() {
        const searchTerm = document.getElementById('searchTasks').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        const priorityFilter = document.getElementById('priorityFilter').value;
        const dueDateFilter = document.getElementById('dueDateFilter').value;
        
        filteredTasks = currentTasks.filter(task => {
            const matchesSearch = !searchTerm || 
                task.description.toLowerCase().includes(searchTerm) ||
                (task.notes && task.notes.toLowerCase().includes(searchTerm));
            
            const matchesStatus = !statusFilter || task.status === statusFilter;
            const matchesPriority = !priorityFilter || task.priority === priorityFilter;
            
            let matchesDueDate = true;
            if (dueDateFilter) {
                const now = new Date();
                const taskDue = task.due_date ? new Date(task.due_date) : null;
                
                switch (dueDateFilter) {
                    case 'today':
                        matchesDueDate = taskDue && taskDue.toDateString() === now.toDateString();
                        break;
                    case 'this_week':
                        const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
                        const weekEnd = new Date(now.setDate(now.getDate() - now.getDay() + 6));
                        matchesDueDate = taskDue && taskDue >= weekStart && taskDue <= weekEnd;
                        break;
                    case 'overdue':
                        matchesDueDate = isTaskOverdue(task);
                        break;
                }
            }
            
            return matchesSearch && matchesStatus && matchesPriority && matchesDueDate;
        });
        
        renderTasks();
    }
    
    // Render tasks based on current view mode
    function renderTasks() {
        switch (currentViewMode) {
            case 'list':
                renderListView();
                break;
            case 'kanban':
                renderKanbanView();
                break;
            case 'calendar':
                renderCalendarView();
                break;
        }
    }
    
    // Render list view
    function renderListView() {
        const container = document.getElementById('tasksContainer');
        
        if (filteredTasks.length === 0) {
            container.innerHTML = `
                <div class="text-center text-muted py-5">
                    <i class="fas fa-tasks fa-3x mb-3"></i>
                    <p>No tasks found matching your criteria.</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = filteredTasks.map(task => createTaskListItem(task)).join('');
    }
    
    // Create task list item
    function createTaskListItem(task) {
        const priorityClass = `${task.priority}-priority`;
        const overdueClass = isTaskOverdue(task) ? 'overdue' : '';
        const statusColor = getStatusColor(task.status);
        
        return `
            <div class="task-item ${priorityClass} ${overdueClass}" onclick="viewTaskDetails(${task.id})">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-2">
                            <span class="progress-indicator status-${task.status}"></span>
                            <h6 class="mb-0">${task.description}</h6>
                        </div>
                        <div class="mb-1">
                            <span class="priority-badge bg-${getPriorityColor(task.priority)} text-white">${task.priority}</span>
                            ${task.related_people ? task.related_people.slice(0, 2).map(p => `<span class="entity-tag">${p.name}</span>`).join('') : ''}
                        </div>
                        ${task.notes ? `<small class="text-muted">${task.notes.substring(0, 100)}...</small>` : ''}
                    </div>
                    <div class="col-md-2">
                        <small class="text-muted">
                            ${task.due_date ? `Due: ${new Date(task.due_date).toLocaleDateString()}` : 'No due date'}
                        </small>
                    </div>
                    <div class="col-md-2">
                        <small class="text-muted">
                            ${task.estimated_time ? `Est: ${task.estimated_time}h` : ''}
                        </small>
                    </div>
                    <div class="col-md-2 text-end">
                        <span class="badge bg-${statusColor}">${task.status.replace('_', ' ')}</span>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Render kanban view
    function renderKanbanView() {
        const statuses = ['pending', 'in_progress', 'completed', 'cancelled'];
        
        statuses.forEach(status => {
            const container = document.getElementById(`${status}-tasks`);
            const statusTasks = filteredTasks.filter(task => task.status === status);
            
            container.innerHTML = statusTasks.map(task => createKanbanTask(task)).join('');
        });
    }
    
    // Create kanban task card
    function createKanbanTask(task) {
        return `
            <div class="kanban-task" onclick="viewTaskDetails(${task.id})" draggable="true">
                <div class="mb-2">
                    <strong>${task.description}</strong>
                    <span class="priority-badge bg-${getPriorityColor(task.priority)} text-white float-end">${task.priority}</span>
                </div>
                ${task.due_date ? `<div class="small text-muted mb-1">Due: ${new Date(task.due_date).toLocaleDateString()}</div>` : ''}
                ${task.related_people ? task.related_people.slice(0, 2).map(p => `<span class="entity-tag">${p.name}</span>`).join('') : ''}
            </div>
        `;
    }
    
    // Task modal functions
    function openAddTaskModal() {
        currentEditingTask = null;
        document.getElementById('taskModalTitle').innerHTML = '<i class="fas fa-plus me-2"></i>Add New Task';
        document.getElementById('taskForm').reset();
        document.getElementById('taskId').value = '';
        new bootstrap.Modal(document.getElementById('taskModal')).show();
    }
    
    async function saveTask() {
        const form = document.getElementById('taskForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        const taskData = {
            description: document.getElementById('taskDescription').value,
            priority: document.getElementById('taskPriority').value,
            status: document.getElementById('taskStatus').value,
            due_date: document.getElementById('taskDueDate').value || null,
            estimated_time: document.getElementById('taskEstimatedTime').value || null,
            notes: document.getElementById('taskNotes').value,
            related_people: Array.from(document.getElementById('relatedPeople').selectedOptions).map(opt => opt.value),
            related_topics: Array.from(document.getElementById('relatedTopics').selectedOptions).map(opt => opt.value)
        };
        
        const taskId = document.getElementById('taskId').value;
        
        try {
            showLoading();
            let response;
            
            if (taskId) {
                response = await axios.put(`/api/entities/tasks/${taskId}`, taskData);
            } else {
                response = await axios.post('/api/entities/tasks', taskData);
            }
            
            hideLoading();
            
            if (response.data.success) {
                showAlert(`Task ${taskId ? 'updated' : 'created'} successfully!`, 'success');
                bootstrap.Modal.getInstance(document.getElementById('taskModal')).hide();
                loadTasks();
            } else {
                showAlert(`Failed to ${taskId ? 'update' : 'create'} task: ` + response.data.error, 'danger');
            }
        } catch (error) {
            hideLoading();
            showAlert(`Error ${taskId ? 'updating' : 'creating'} task: ` + error.message, 'danger');
        }
    }
    
    // View mode functions
    function changeViewMode() {
        currentViewMode = document.getElementById('viewMode').value;
        
        // Hide all views
        document.getElementById('listView').style.display = 'none';
        document.getElementById('kanbanView').style.display = 'none';
        document.getElementById('calendarView').style.display = 'none';
        
        // Show selected view
        document.getElementById(currentViewMode + 'View').style.display = 'block';
        
        renderTasks();
    }
    
    // Utility functions
    function populatePeopleSelect() {
        const select = document.getElementById('relatedPeople');
        select.innerHTML = people.map(person => 
            `<option value="${person.id}">${person.name}</option>`
        ).join('');
    }
    
    function populateTopicsSelect() {
        const select = document.getElementById('relatedTopics');
        select.innerHTML = topics.map(topic => 
            `<option value="${topic.id}">${topic.name}</option>`
        ).join('');
    }
    
    function isTaskOverdue(task) {
        if (!task.due_date || task.status === 'completed') return false;
        return new Date(task.due_date) < new Date();
    }
    
    function getPriorityColor(priority) {
        switch(priority) {
            case 'high': return 'danger';
            case 'medium': return 'warning';
            case 'low': return 'info';
            default: return 'secondary';
        }
    }
    
    function getStatusColor(status) {
        switch(status) {
            case 'completed': return 'success';
            case 'in_progress': return 'info';
            case 'pending': return 'warning';
            case 'cancelled': return 'secondary';
            default: return 'secondary';
        }
    }
    
    function clearFilters() {
        document.getElementById('searchTasks').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('priorityFilter').value = '';
        document.getElementById('dueDateFilter').value = '';
        filteredTasks = [...currentTasks];
        renderTasks();
    }
    
    function viewTaskDetails(taskId) {
        const task = currentTasks.find(t => t.id === taskId);
        if (task) {
            // Open edit modal with task data
            currentEditingTask = task;
            document.getElementById('taskModalTitle').innerHTML = '<i class="fas fa-edit me-2"></i>Edit Task';
            
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskDescription').value = task.description;
            document.getElementById('taskPriority').value = task.priority || 'medium';
            document.getElementById('taskStatus').value = task.status || 'pending';
            document.getElementById('taskDueDate').value = task.due_date ? task.due_date.slice(0, 16) : '';
            document.getElementById('taskEstimatedTime').value = task.estimated_time || '';
            document.getElementById('taskNotes').value = task.notes || '';
            
            new bootstrap.Modal(document.getElementById('taskModal')).show();
        }
    }
    
    async function generateTasksFromEmails() {
        try {
            showLoading();
            const response = await axios.post('/api/v2/tasks/from-email', {
                days_back: 7,
                limit: 20
            });
            
            hideLoading();
            
            if (response.data.success) {
                showAlert(`Generated ${response.data.data.tasks_created} tasks from emails!`, 'success');
                loadTasks();
            } else {
                showAlert('Failed to generate tasks from emails: ' + response.data.error, 'danger');
            }
        } catch (error) {
            hideLoading();
            showAlert('Error generating tasks from emails: ' + error.message, 'danger');
        }
    }
    
    function bulkActions() {
        showAlert('Bulk actions feature coming soon!', 'info');
    }
    
    function exportTasks() {
        const data = filteredTasks.map(task => ({
            description: task.description,
            status: task.status,
            priority: task.priority,
            due_date: task.due_date,
            created_at: task.created_at
        }));
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `tasks-export-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }
    
    function renderCalendarView() {
        document.getElementById('taskCalendar').innerHTML = `
            <div class="text-center text-muted py-5">
                <i class="fas fa-calendar fa-3x mb-3"></i>
                <p>Calendar view implementation coming soon!</p>
            </div>
        `;
    }
</script>
{% endblock %} 