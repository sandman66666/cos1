<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chief of Staff - Tasks</title>
    
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
        rel="stylesheet"
        as="style"
        onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body>
<div class="relative flex size-full min-h-screen flex-col bg-[#101a23] dark group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
        <div class="gap-1 px-6 flex flex-1 justify-center py-5">
            
            <!-- Left Sidebar -->
            <div class="layout-content-container flex flex-col w-80">
                <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#101a23] p-4">
                    <div class="flex flex-col gap-4">
                        <!-- Logo/Header -->
                        <div class="flex gap-3">
                            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold">
                                ðŸ¤–
                            </div>
                            <h1 class="text-white text-base font-medium leading-normal">AI Chief of Staff</h1>
                        </div>
                        
                        <!-- Navigation Menu -->
                        <div class="flex flex-col gap-2">
                            <a href="/home" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                <div class="text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                        <path d="M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z"></path>
                                    </svg>
                                </div>
                                <p class="text-white text-sm font-medium leading-normal">Home</p>
                            </a>
                            
                            <div class="flex items-center gap-3 px-3 py-2 rounded-full bg-[#223649]">
                                <div class="text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                        <path d="M56,128a16,16,0,1,1-16-16A16,16,0,0,1,56,128ZM40,48A16,16,0,1,0,56,64,16,16,0,0,0,40,48Zm0,128a16,16,0,1,0,16,16A16,16,0,0,0,40,176Zm176-64H88a8,8,0,0,0-8,8v16a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V120A8,8,0,0,0,216,112Zm0-64H88a8,8,0,0,0-8,8V72a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V56A8,8,0,0,0,216,48Zm0,128H88a8,8,0,0,0-8,8v16a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V184A8,8,0,0,0,216,176Z"></path>
                                    </svg>
                                </div>
                                <p class="text-white text-sm font-medium leading-normal">Tasks</p>
                            </div>
                            
                            <a href="/knowledge" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                <div class="text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                        <path d="M224,48H160a40,40,0,0,0-32,16A40,40,0,0,0,96,48H32A16,16,0,0,0,16,64V192a16,16,0,0,0,16,16H96a24,24,0,0,1,24,24,8,8,0,0,0,16,0,24,24,0,0,1,24-24h64a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48ZM96,192H32V64H96a24,24,0,0,1,24,24V200A39.81,39.81,0,0,0,96,192Zm128,0H160a39.81,39.81,0,0,0-24,8V88a24,24,0,0,1,24-24h64Z"></path>
                                    </svg>
                                </div>
                                <p class="text-white text-sm font-medium leading-normal">Knowledge</p>
                            </a>
                            
                            <a href="/people" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                <div class="text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                        <path d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,1,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"></path>
                                    </svg>
                                </div>
                                <p class="text-white text-sm font-medium leading-normal">People</p>
                            </a>
                            
                            <a href="/settings" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                <div class="text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                        <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25a8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87a8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25a8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25a8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87a8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88a8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25a8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"></path>
                                    </svg>
                                </div>
                                <p class="text-white text-sm font-medium leading-normal">Settings</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                <!-- Header Section -->
                <div class="flex flex-wrap justify-between gap-3 p-4">
                    <div class="flex min-w-72 flex-col gap-3">
                        <p class="text-white tracking-light text-[32px] font-bold leading-tight">Tasks</p>
                        <p class="text-[#90aecb] text-sm font-normal leading-normal">AI-generated tasks from your emails and conversations</p>
                    </div>
                    <div class="flex gap-3">
                        <button id="processEmailsBtn" class="flex items-center gap-2 px-4 py-2 bg-[#0b80ee] text-white rounded-full text-sm font-medium hover:bg-[#0966c7] transition-colors">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M224,48H32a8,8,0,0,0-8,8V192a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A8,8,0,0,0,224,48Zm-96,85.15L52.57,64H203.43ZM98.71,128,40,181.81V74.19Zm11.84,10.85,12,11.05a8,8,0,0,0,10.82,0l12-11.05,58,53.15H52.57ZM157.29,128,216,74.18V181.82Z"></path>
                            </svg>
                            Generate Tasks
                        </button>
                        <button id="refreshBtn" class="flex items-center gap-2 px-4 py-2 bg-[#223649] text-white rounded-full text-sm font-medium hover:bg-[#2a3e50] transition-colors">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M197.67,186.37a8,8,0,0,1,0,11.29C196.58,198.73,170.82,224,128,224c-37.39,0-64.53-22.4-80-39.85V208a8,8,0,0,1-16,0V160a8,8,0,0,1,8-8H88a8,8,0,0,1,0,16H55.44C67.76,183.35,93,208,128,208c36.72,0,58.4-21.15,58.38-21.13A8,8,0,0,1,197.67,186.37ZM216,40a8,8,0,0,0-8,8V71.85C192.53,54.4,165.39,32,128,32,85.18,32,59.42,57.27,58.33,58.34a8,8,0,0,0,11.34,11.32C69.86,69.47,91.54,48.17,128,48c35,0,60.24,24.65,72.56,40H168a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V48A8,8,0,0,0,216,40Z"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Filter Tabs -->
                <div class="pb-3">
                    <div class="flex border-b border-[#314d68] px-4 gap-8">
                        <button class="filter-tab flex flex-col items-center justify-center border-b-[3px] border-b-[#0b80ee] text-white pb-[13px] pt-4" data-status="">
                            <p class="text-white text-sm font-bold leading-normal tracking-[0.015em]">All</p>
                        </button>
                        <button class="filter-tab flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#90aecb] pb-[13px] pt-4" data-status="open">
                            <p class="text-[#90aecb] text-sm font-bold leading-normal tracking-[0.015em]">Open</p>
                        </button>
                        <button class="filter-tab flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#90aecb] pb-[13px] pt-4" data-status="in_progress">
                            <p class="text-[#90aecb] text-sm font-bold leading-normal tracking-[0.015em]">In Progress</p>
                        </button>
                        <button class="filter-tab flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#90aecb] pb-[13px] pt-4" data-status="completed">
                            <p class="text-[#90aecb] text-sm font-bold leading-normal tracking-[0.015em]">Completed</p>
                        </button>
                    </div>
                </div>
                
                <!-- Tasks Table -->
                <div class="px-4 py-3">
                    <div id="loadingContainer" class="flex items-center justify-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
                        <span class="ml-3 text-white">Loading tasks...</span>
                    </div>
                    
                    <div id="tasksTableContainer" class="hidden">
                        <div class="flex overflow-hidden rounded-xl border border-[#314d68] bg-[#101a23]">
                            <table class="flex-1">
                                <thead>
                                    <tr class="bg-[#182734]">
                                        <th class="px-4 py-3 text-left text-white text-sm font-medium leading-normal">Task</th>
                                        <th class="px-4 py-3 text-left text-white text-sm font-medium leading-normal">Source</th>
                                        <th class="px-4 py-3 text-left text-white text-sm font-medium leading-normal">Priority</th>
                                        <th class="px-4 py-3 text-left text-white text-sm font-medium leading-normal">Due Date</th>
                                        <th class="px-4 py-3 text-left text-white text-sm font-medium leading-normal">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="tasksTableBody">
                                    <!-- Tasks will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="emptyStateContainer" class="hidden text-center py-12">
                        <div class="text-white mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 mb-4" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM224,48V208a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32H208A16,16,0,0,1,224,48ZM208,208V48H48V208H208Z"></path>
                            </svg>
                        </div>
                        <h3 class="text-white text-xl font-semibold mb-2">No tasks yet</h3>
                        <p class="text-[#90aecb] mb-4">Process your emails to automatically generate tasks</p>
                        <button id="generateTasksBtn" class="px-6 py-2 bg-[#0b80ee] text-white rounded-full font-medium hover:bg-[#0966c7] transition-colors">
                            Generate Tasks from Emails
                        </button>
                    </div>
                </div>
                
                <!-- Task Stats -->
                <div id="statsContainer" class="hidden px-4 py-4">
                    <div class="grid grid-cols-4 gap-4">
                        <div class="bg-[#223649] rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-white" id="totalTasks">0</div>
                            <div class="text-sm text-[#90aecb]">Total Tasks</div>
                        </div>
                        <div class="bg-[#223649] rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-400" id="openTasks">0</div>
                            <div class="text-sm text-[#90aecb]">Open</div>
                        </div>
                        <div class="bg-[#223649] rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-yellow-400" id="inProgressTasks">0</div>
                            <div class="text-sm text-[#90aecb]">In Progress</div>
                        </div>
                        <div class="bg-[#223649] rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-400" id="completedTasks">0</div>
                            <div class="text-sm text-[#90aecb]">Completed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Global state
let allTasks = [];
let currentFilter = '';

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    loadTasks();
    setupEventListeners();
});

function setupEventListeners() {
    // Process emails button
    document.getElementById('processEmailsBtn').addEventListener('click', processEmails);
    
    // Refresh button
    document.getElementById('refreshBtn').addEventListener('click', refreshTasks);
    
    // Generate tasks button (in empty state)
    document.getElementById('generateTasksBtn').addEventListener('click', processEmails);
    
    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const status = tab.dataset.status;
            filterTasks(status);
            updateActiveTab(tab);
        });
    });
}

async function loadTasks(status = '') {
    showLoading();
    
    try {
        const url = status ? `/api/tasks?status=${status}` : '/api/tasks';
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success) {
            allTasks = data.tasks || [];
            displayTasks(allTasks);
            updateStats(allTasks);
        } else {
            console.error('Failed to load tasks:', data.error);
            showEmptyState();
        }
        
    } catch (error) {
        console.error('Error loading tasks:', error);
        showError('Failed to load tasks. Please refresh the page.');
        showEmptyState();
    }
}

function displayTasks(tasks) {
    const loadingContainer = document.getElementById('loadingContainer');
    const tableContainer = document.getElementById('tasksTableContainer');
    const emptyContainer = document.getElementById('emptyStateContainer');
    const statsContainer = document.getElementById('statsContainer');
    const tableBody = document.getElementById('tasksTableBody');
    
    loadingContainer.classList.add('hidden');
    
    if (!tasks || tasks.length === 0) {
        tableContainer.classList.add('hidden');
        statsContainer.classList.add('hidden');
        emptyContainer.classList.remove('hidden');
        return;
    }
    
    emptyContainer.classList.add('hidden');
    tableContainer.classList.remove('hidden');
    statsContainer.classList.remove('hidden');
    
    // Populate table
    tableBody.innerHTML = tasks.map(task => `
        <tr class="border-t border-t-[#314d68] hover:bg-[#223649] transition-colors">
            <td class="px-4 py-4 text-white text-sm">
                <div class="font-medium">${escapeHtml(task.description || 'Untitled Task')}</div>
                ${task.details ? `<div class="text-[#90aecb] text-xs mt-1">${escapeHtml(task.details)}</div>` : ''}
            </td>
            <td class="px-4 py-4 text-[#90aecb] text-sm">
                ${getSourceDisplay(task.source)}
            </td>
            <td class="px-4 py-4 text-sm">
                <span class="px-3 py-1 rounded-full text-xs font-medium ${getPriorityStyle(task.priority)}">
                    ${task.priority || 'Medium'}
                </span>
            </td>
            <td class="px-4 py-4 text-[#90aecb] text-sm">
                ${formatDate(task.due_date) || 'No due date'}
            </td>
            <td class="px-4 py-4 text-sm">
                <select class="bg-[#223649] text-white rounded px-2 py-1 text-xs border-none" 
                        onchange="updateTaskStatus(${task.id}, this.value)">
                    <option value="open" ${task.status === 'open' ? 'selected' : ''}>Open</option>
                    <option value="in_progress" ${task.status === 'in_progress' ? 'selected' : ''}>In Progress</option>
                    <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>Completed</option>
                </select>
            </td>
        </tr>
    `).join('');
}

function updateStats(tasks) {
    const total = tasks.length;
    const open = tasks.filter(t => t.status === 'open' || !t.status).length;
    const inProgress = tasks.filter(t => t.status === 'in_progress').length;
    const completed = tasks.filter(t => t.status === 'completed').length;
    
    document.getElementById('totalTasks').textContent = total;
    document.getElementById('openTasks').textContent = open;
    document.getElementById('inProgressTasks').textContent = inProgress;
    document.getElementById('completedTasks').textContent = completed;
}

function filterTasks(status) {
    currentFilter = status;
    const filteredTasks = status ? allTasks.filter(task => task.status === status) : allTasks;
    displayTasks(filteredTasks);
}

function updateActiveTab(activeTab) {
    // Remove active styles from all tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('border-b-[#0b80ee]', 'text-white');
        tab.classList.add('border-b-transparent', 'text-[#90aecb]');
        const p = tab.querySelector('p');
        p.classList.remove('text-white');
        p.classList.add('text-[#90aecb]');
    });
    
    // Add active styles to clicked tab
    activeTab.classList.remove('border-b-transparent', 'text-[#90aecb]');
    activeTab.classList.add('border-b-[#0b80ee]', 'text-white');
    const p = activeTab.querySelector('p');
    p.classList.remove('text-[#90aecb]');
    p.classList.add('text-white');
}

async function processEmails() {
    const btn = document.getElementById('processEmailsBtn') || document.getElementById('generateTasksBtn');
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div> Processing...';
    btn.disabled = true;
    
    try {
        const response = await fetch('/api/process-emails', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                max_emails: 20,
                days_back: 7,
                force_refresh: false
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess(`Processed ${data.summary.emails_fetched} emails and created ${data.summary.tasks_created} new tasks`);
            // Reload tasks
            await loadTasks(currentFilter);
        } else {
            showError(data.error || 'Failed to process emails');
        }
        
    } catch (error) {
        console.error('Error processing emails:', error);
        showError('Failed to process emails. Please try again.');
    } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}

async function refreshTasks() {
    const btn = document.getElementById('refreshBtn');
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div> Refreshing...';
    btn.disabled = true;
    
    try {
        await loadTasks(currentFilter);
        showSuccess('Tasks refreshed successfully');
    } catch (error) {
        console.error('Error refreshing tasks:', error);
        showError('Failed to refresh tasks');
    } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}

async function updateTaskStatus(taskId, newStatus) {
    try {
        // Note: This would need to be implemented in the backend
        // For now, just update locally
        const task = allTasks.find(t => t.id === taskId);
        if (task) {
            task.status = newStatus;
            displayTasks(currentFilter ? allTasks.filter(t => t.status === currentFilter) : allTasks);
            updateStats(allTasks);
        }
        
        showSuccess('Task status updated');
    } catch (error) {
        console.error('Error updating task status:', error);
        showError('Failed to update task status');
    }
}

function showLoading() {
    document.getElementById('loadingContainer').classList.remove('hidden');
    document.getElementById('tasksTableContainer').classList.add('hidden');
    document.getElementById('emptyStateContainer').classList.add('hidden');
    document.getElementById('statsContainer').classList.add('hidden');
}

function showEmptyState() {
    document.getElementById('loadingContainer').classList.add('hidden');
    document.getElementById('tasksTableContainer').classList.add('hidden');
    document.getElementById('statsContainer').classList.add('hidden');
    document.getElementById('emptyStateContainer').classList.remove('hidden');
}

function getSourceDisplay(source) {
    if (!source) return 'Unknown';
    if (source === 'email') return 'Email Analysis';
    if (source === 'manual') return 'Manual Entry';
    return source;
}

function getPriorityStyle(priority) {
    switch (priority?.toLowerCase()) {
        case 'high':
            return 'bg-red-500 text-white';
        case 'medium':
            return 'bg-yellow-500 text-black';
        case 'low':
            return 'bg-green-500 text-white';
        default:
            return 'bg-gray-500 text-white';
    }
}

function formatDate(dateString) {
    if (!dateString) return null;
    try {
        const date = new Date(dateString);
        return date.toLocaleDateString();
    } catch (error) {
        return 'Invalid date';
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showSuccess(message) {
    const toast = document.createElement('div');
    toast.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3000);
}

function showError(message) {
    const toast = document.createElement('div');
    toast.className = 'fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-lg z-50';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 5000);
}
</script>
</body>
</html> 