<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Intelligence - AI Chief of Staff</title>
    
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
        rel="stylesheet"
        as="style"
        onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <style>
        .intelligence-card {
            transition: all 0.2s ease;
        }
        .intelligence-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .priority-critical { border-left: 4px solid #ef4444; }
        .priority-high { border-left: 4px solid #f97316; }
        .priority-medium { border-left: 4px solid #eab308; }
        .priority-low { border-left: 4px solid #22c55e; }
        
        .context-opportunity { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .context-relationship { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .context-project { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .context-challenge { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    </style>
</head>

<body class="bg-[#111a22] text-white font-['Inter']">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-[#1a252f] border-b border-[#314d68] px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-white">üß† Strategic Intelligence</h1>
                    <span class="text-[#90aecb] text-sm">AI Chief of Staff</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="generateStrategicIntelligence()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        üîÑ Generate Intelligence
                    </button>
                    <a href="/home" class="text-[#90aecb] hover:text-white transition-colors">
                        ‚Üê Back to Home
                    </a>
                </div>
            </div>
        </header>

        <!-- Loading State -->
        <div id="loadingState" class="hidden">
            <div class="flex items-center justify-center py-20">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                    <p class="text-[#90aecb]">Generating strategic intelligence...</p>
                    <p class="text-sm text-[#6b7d8f] mt-2">Analyzing your communications for strategic insights</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main id="mainContent" class="px-6 py-8">
            
            <!-- Intelligence Brief Header -->
            <div id="intelligenceBrief" class="mb-8 hidden">
                <div class="bg-[#182734] rounded-lg border border-[#314d68] p-6">
                    <h2 class="text-xl font-bold text-white mb-4">üìä Executive Intelligence Brief</h2>
                    <div id="executiveSummary" class="text-[#90aecb] text-lg leading-relaxed mb-6">
                        <!-- Executive summary will be populated here -->
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-[#1a252f] rounded-lg p-4 text-center">
                            <div id="contextCount" class="text-2xl font-bold text-blue-400">0</div>
                            <div class="text-sm text-[#90aecb]">Business Contexts</div>
                        </div>
                        <div class="bg-[#1a252f] rounded-lg p-4 text-center">
                            <div id="insightCount" class="text-2xl font-bold text-green-400">0</div>
                            <div class="text-sm text-[#90aecb]">Strategic Insights</div>
                        </div>
                        <div class="bg-[#1a252f] rounded-lg p-4 text-center">
                            <div id="recommendationCount" class="text-2xl font-bold text-orange-400">0</div>
                            <div class="text-sm text-[#90aecb]">Recommendations</div>
                        </div>
                        <div class="bg-[#1a252f] rounded-lg p-4 text-center">
                            <div id="criticalActions" class="text-2xl font-bold text-red-400">0</div>
                            <div class="text-sm text-[#90aecb]">Critical Actions</div>
                        </div>
                    </div>
                    
                    <!-- Smart Contact Strategy Efficiency Metrics -->
                    <div id="engagementEfficiency" class="mt-6 p-4 bg-gradient-to-r from-green-900 to-blue-900 rounded-lg border border-green-600 hidden">
                        <h3 class="text-lg font-bold text-white mb-3">üéØ Engagement Intelligence Efficiency</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                            <div>
                                <div id="efficiencyRatio" class="text-xl font-bold text-green-300">0%</div>
                                <div class="text-xs text-green-200">Content Efficiency</div>
                                <div class="text-xs text-[#90aecb]">vs. processing all emails</div>
                            </div>
                            <div>
                                <div id="trustedContactsCount" class="text-xl font-bold text-blue-300">0</div>
                                <div class="text-xs text-blue-200">Trusted Contacts</div>
                                <div class="text-xs text-[#90aecb]">proven business relationships</div>
                            </div>
                            <div>
                                <div id="contentQualityScore" class="text-xl font-bold text-purple-300">0%</div>
                                <div class="text-xs text-purple-200">Content Quality</div>
                                <div class="text-xs text-[#90aecb]">business relevance score</div>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <div class="text-sm text-green-200">
                                ‚ú® <span class="font-semibold">Smart Contact Strategy Active</span> - Focusing on engagement-driven business intelligence
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Critical Actions -->
            <div id="criticalActionsSection" class="mb-8 hidden">
                <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-lg border border-red-500 p-6">
                    <h2 class="text-xl font-bold text-white mb-4">üö® Critical Actions Required</h2>
                    <div id="criticalActionsList" class="space-y-4">
                        <!-- Critical actions will be populated here -->
                    </div>
                </div>
            </div>

            <!-- High Priority Recommendations -->
            <div id="highPrioritySection" class="mb-8 hidden">
                <div class="bg-[#182734] rounded-lg border border-[#314d68] p-6">
                    <h2 class="text-xl font-bold text-white mb-4">‚ö° High Priority Recommendations</h2>
                    <div id="highPriorityList" class="space-y-4">
                        <!-- High priority items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Business Contexts Grid -->
            <div id="businessContextsSection" class="mb-8 hidden">
                <h2 class="text-xl font-bold text-white mb-6">üíº Strategic Business Contexts</h2>
                <div id="businessContextsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Business contexts will be populated here -->
                </div>
            </div>

            <!-- Strategic Insights -->
            <div id="strategicInsightsSection" class="mb-8 hidden">
                <h2 class="text-xl font-bold text-white mb-6">üîç Strategic Insights</h2>
                <div id="strategicInsightsList" class="space-y-6">
                    <!-- Strategic insights will be populated here -->
                </div>
            </div>

            <!-- All Recommendations -->
            <div id="allRecommendationsSection" class="mb-8 hidden">
                <h2 class="text-xl font-bold text-white mb-6">üìã Strategic Recommendations</h2>
                <div id="allRecommendationsList" class="space-y-6">
                    <!-- All recommendations will be populated here -->
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-20">
                <div class="text-6xl mb-4">üß†</div>
                <h2 class="text-2xl font-bold text-white mb-4">Ready to Generate Strategic Intelligence</h2>
                <p class="text-[#90aecb] mb-8 max-w-2xl mx-auto">
                    Transform your communications into strategic business intelligence. Get unified business contexts, 
                    strategic insights, and actionable recommendations instead of managing individual emails.
                </p>
                <button onclick="generateStrategicIntelligence()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-colors text-lg">
                    üöÄ Generate Strategic Intelligence
                </button>
            </div>

        </main>
    </div>

    <script>
        // Global state
        let currentIntelligence = null;

        // Generate Strategic Intelligence
        async function generateStrategicIntelligence() {
            try {
                showLoading();
                
                const response = await fetch('/api/strategic-intelligence', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentIntelligence = data;
                    displayStrategicIntelligence(data);
                    showSuccess('Strategic intelligence generated successfully!');
                } else {
                    showError(`Failed to generate intelligence: ${data.error}`);
                }
                
            } catch (error) {
                console.error('Error generating strategic intelligence:', error);
                showError('Failed to generate strategic intelligence');
            } finally {
                hideLoading();
            }
        }

        // Display Strategic Intelligence
        function displayStrategicIntelligence(data) {
            hideEmptyState();
            
            // Update executive summary
            displayExecutiveSummary(data.intelligence_brief);
            
            // Display critical actions
            displayCriticalActions(data.intelligence_brief.critical_actions);
            
            // Display high priority recommendations
            displayHighPriorityRecommendations(data.intelligence_brief.high_priority_actions);
            
            // Display business contexts
            displayBusinessContexts(data.business_contexts);
            
            // Display strategic insights
            displayStrategicInsights(data.strategic_insights);
            
            // Display all recommendations
            displayAllRecommendations(data.recommendations);
        }

        // Display Executive Summary
        function displayExecutiveSummary(brief) {
            document.getElementById('executiveSummary').textContent = brief.executive_summary;
            document.getElementById('contextCount').textContent = brief.business_contexts_summary.total_contexts;
            document.getElementById('insightCount').textContent = brief.strategic_insights.count;
            document.getElementById('recommendationCount').textContent = brief.high_priority_actions.count + brief.critical_actions.count;
            document.getElementById('criticalActions').textContent = brief.critical_actions.count;
            
            // Display Smart Contact Strategy efficiency metrics
            const engagementIntelligence = brief.engagement_intelligence;
            if (engagementIntelligence && engagementIntelligence.smart_contact_strategy_active) {
                // Show efficiency metrics
                const efficiencySection = document.getElementById('engagementEfficiency');
                efficiencySection.classList.remove('hidden');
                
                // Update efficiency metrics
                const efficiencyData = engagementIntelligence.engagement_efficiency || {};
                document.getElementById('efficiencyRatio').textContent = 
                    Math.round((efficiencyData.content_efficiency_ratio || 0.75) * 100) + '%';
                
                document.getElementById('trustedContactsCount').textContent = 
                    engagementIntelligence.trusted_contacts_count || 0;
                
                document.getElementById('contentQualityScore').textContent = 
                    Math.round((efficiencyData.content_quality_score || 0.85) * 100) + '%';
            }
            
            document.getElementById('intelligenceBrief').classList.remove('hidden');
        }

        // Display Critical Actions
        function displayCriticalActions(criticalActions) {
            if (criticalActions.count === 0) return;
            
            const container = document.getElementById('criticalActionsList');
            container.innerHTML = '';
            
            criticalActions.items.forEach(action => {
                const actionElement = document.createElement('div');
                actionElement.className = 'bg-red-800 bg-opacity-50 rounded-lg p-4 border border-red-600';
                actionElement.innerHTML = `
                    <h3 class="font-bold text-white mb-2">${action.title}</h3>
                    <p class="text-red-100 mb-3">${action.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-red-200 text-sm">Impact: ${action.impact}</span>
                        <span class="bg-red-600 text-white px-3 py-1 rounded-full text-sm">CRITICAL</span>
                    </div>
                    <div class="mt-3 text-red-200 text-sm">
                        <strong>Why:</strong> ${action.rationale}
                    </div>
                `;
                container.appendChild(actionElement);
            });
            
            document.getElementById('criticalActionsSection').classList.remove('hidden');
        }

        // Display High Priority Recommendations
        function displayHighPriorityRecommendations(highPriorityActions) {
            if (highPriorityActions.count === 0) return;
            
            const container = document.getElementById('highPriorityList');
            container.innerHTML = '';
            
            highPriorityActions.items.forEach(action => {
                const actionElement = document.createElement('div');
                actionElement.className = 'bg-orange-800 bg-opacity-30 rounded-lg p-4 border border-orange-600 intelligence-card';
                actionElement.innerHTML = `
                    <h3 class="font-bold text-white mb-2">${action.title}</h3>
                    <p class="text-orange-100 mb-3">${action.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-orange-200 text-sm">Impact: ${action.impact}</span>
                        <span class="bg-orange-600 text-white px-3 py-1 rounded-full text-sm">HIGH PRIORITY</span>
                    </div>
                    <div class="mt-3 text-orange-200 text-sm">
                        <strong>Rationale:</strong> ${action.rationale}
                    </div>
                `;
                container.appendChild(actionElement);
            });
            
            document.getElementById('highPrioritySection').classList.remove('hidden');
        }

        // Display Business Contexts
        function displayBusinessContexts(contexts) {
            if (contexts.length === 0) return;
            
            const container = document.getElementById('businessContextsGrid');
            container.innerHTML = '';
            
            contexts.forEach(context => {
                const contextElement = document.createElement('div');
                contextElement.className = `intelligence-card bg-[#182734] rounded-lg border border-[#314d68] p-6 context-${context.type}`;
                
                const priorityClass = getPriorityClass(context.priority_score);
                const typeIcon = getContextTypeIcon(context.type);
                
                contextElement.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${typeIcon}</span>
                            <div>
                                <h3 class="font-bold text-white">${context.name}</h3>
                                <span class="text-sm text-[#90aecb] capitalize">${context.type}</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full ${priorityClass}"></div>
                            <span class="text-xs text-[#90aecb]">${Math.round(context.priority_score * 100)}%</span>
                        </div>
                    </div>
                    
                    <p class="text-[#90aecb] mb-4">${context.description}</p>
                    
                    <div class="space-y-2">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-[#6b7d8f]">Status:</span>
                            <span class="text-white capitalize">${context.status}</span>
                        </div>
                        ${context.key_people && context.key_people.length > 0 ? `
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-[#6b7d8f]">Key People:</span>
                            <span class="text-white">${context.key_people.slice(0, 2).join(', ')}</span>
                        </div>
                        ` : ''}
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-[#6b7d8f]">Confidence:</span>
                            <span class="text-white">${Math.round(context.confidence_level * 100)}%</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-[#1a252f] rounded-lg">
                        <p class="text-sm text-[#90aecb]"><strong>Impact:</strong> ${context.impact_assessment}</p>
                    </div>
                `;
                
                container.appendChild(contextElement);
            });
            
            document.getElementById('businessContextsSection').classList.remove('hidden');
        }

        // Display Strategic Insights
        function displayStrategicInsights(insights) {
            if (insights.length === 0) return;
            
            const container = document.getElementById('strategicInsightsList');
            container.innerHTML = '';
            
            insights.forEach(insight => {
                const insightElement = document.createElement('div');
                insightElement.className = 'intelligence-card bg-[#182734] rounded-lg border border-[#314d68] p-6';
                
                const typeIcon = getInsightTypeIcon(insight.type);
                const typeColor = getInsightTypeColor(insight.type);
                
                insightElement.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 ${typeColor} rounded-lg flex items-center justify-center text-white text-xl">
                                ${typeIcon}
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-bold text-white">${insight.title}</h3>
                                <span class="text-xs text-[#90aecb] bg-[#1a252f] px-2 py-1 rounded capitalize">${insight.type}</span>
                            </div>
                            
                            <p class="text-[#90aecb] mb-4">${insight.description}</p>
                            
                            <div class="space-y-3">
                                <div class="p-3 bg-[#1a252f] rounded-lg">
                                    <p class="text-sm text-[#90aecb]"><strong>Business Implications:</strong> ${insight.business_implications}</p>
                                </div>
                                <div class="p-3 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-600">
                                    <p class="text-sm text-blue-200"><strong>Recommended Response:</strong> ${insight.recommended_response}</p>
                                </div>
                            </div>
                            
                            <div class="mt-4 flex items-center justify-between text-sm">
                                <span class="text-[#6b7d8f]">Confidence Level:</span>
                                <span class="text-white">${Math.round(insight.confidence_level * 100)}%</span>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(insightElement);
            });
            
            document.getElementById('strategicInsightsSection').classList.remove('hidden');
        }

        // Display All Recommendations
        function displayAllRecommendations(recommendations) {
            if (recommendations.length === 0) return;
            
            const container = document.getElementById('allRecommendationsList');
            container.innerHTML = '';
            
            recommendations.forEach(rec => {
                const recElement = document.createElement('div');
                recElement.className = `intelligence-card bg-[#182734] rounded-lg border border-[#314d68] p-6 priority-${rec.urgency_level}`;
                
                const urgencyColor = getUrgencyColor(rec.urgency_level);
                
                recElement.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <h3 class="font-bold text-white text-lg">${rec.title}</h3>
                        <div class="flex items-center space-x-2">
                            <span class="${urgencyColor} px-3 py-1 rounded-full text-sm font-medium uppercase">${rec.urgency_level}</span>
                            <span class="bg-[#1a252f] text-[#90aecb] px-3 py-1 rounded-full text-sm">${rec.estimated_impact} Impact</span>
                        </div>
                    </div>
                    
                    <p class="text-[#90aecb] mb-4">${rec.description}</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="p-4 bg-[#1a252f] rounded-lg">
                            <h4 class="font-semibold text-white mb-2">üéØ Rationale</h4>
                            <p class="text-sm text-[#90aecb]">${rec.rationale}</p>
                        </div>
                        <div class="p-4 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-600">
                            <h4 class="font-semibold text-blue-200 mb-2">üìà Impact Analysis</h4>
                            <p class="text-sm text-blue-200">${rec.impact_analysis}</p>
                        </div>
                    </div>
                    
                    ${rec.suggested_actions && rec.suggested_actions.length > 0 ? `
                    <div class="p-4 bg-green-900 bg-opacity-30 rounded-lg border border-green-600">
                        <h4 class="font-semibold text-green-200 mb-3">‚ö° Suggested Actions</h4>
                        <ul class="space-y-2">
                            ${rec.suggested_actions.map(action => `
                                <li class="text-sm text-green-200 flex items-start space-x-2">
                                    <span class="text-green-400 mt-1">‚Ä¢</span>
                                    <span>${action.description}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <div class="mt-4 flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-4">
                            <span class="text-[#6b7d8f]">Time Sensitivity: <span class="text-white">${rec.time_sensitivity}</span></span>
                            <span class="text-[#6b7d8f]">Confidence: <span class="text-white">${Math.round(rec.confidence_score * 100)}%</span></span>
                        </div>
                    </div>
                `;
                
                container.appendChild(recElement);
            });
            
            document.getElementById('allRecommendationsSection').classList.remove('hidden');
        }

        // Utility Functions
        function getContextTypeIcon(type) {
            const icons = {
                'opportunity': 'üí°',
                'relationship': 'ü§ù', 
                'project': 'üìã',
                'challenge': '‚ö†Ô∏è'
            };
            return icons[type] || 'üìã';
        }

        function getInsightTypeIcon(type) {
            const icons = {
                'trend': 'üìà',
                'opportunity': 'üí°',
                'risk': '‚ö†Ô∏è',
                'connection': 'üîó'
            };
            return icons[type] || 'üí°';
        }

        function getInsightTypeColor(type) {
            const colors = {
                'trend': 'bg-blue-600',
                'opportunity': 'bg-green-600',
                'risk': 'bg-red-600',
                'connection': 'bg-purple-600'
            };
            return colors[type] || 'bg-blue-600';
        }

        function getPriorityClass(score) {
            if (score >= 0.8) return 'bg-red-500';
            if (score >= 0.6) return 'bg-orange-500';
            if (score >= 0.4) return 'bg-yellow-500';
            return 'bg-green-500';
        }

        function getUrgencyColor(urgency) {
            const colors = {
                'critical': 'bg-red-600 text-white',
                'high': 'bg-orange-600 text-white',
                'medium': 'bg-yellow-600 text-white',
                'low': 'bg-green-600 text-white'
            };
            return colors[urgency] || 'bg-gray-600 text-white';
        }

        // UI State Management
        function showLoading() {
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function hideEmptyState() {
            document.getElementById('emptyState').classList.add('hidden');
        }

        function showSuccess(message) {
            // Simple alert for now - could be enhanced with toast notifications
            console.log('Success:', message);
        }

        function showError(message) {
            // Simple alert for now - could be enhanced with toast notifications
            alert('Error: ' + message);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Strategic Intelligence Dashboard loaded');
        });
    </script>
</body>
</html> 