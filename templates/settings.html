<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chief of Staff - Settings</title>
    
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
        rel="stylesheet"
        as="style"
        onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>

<body style="margin: 0; line-height: inherit;">
    <div class="relative flex size-full min-h-screen flex-col bg-[#101a23] dark group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
        <div class="layout-container flex h-full grow flex-col">
            <div class="gap-1 px-6 flex flex-1 justify-center py-5">
                
                <!-- Left Sidebar -->
                <div class="layout-content-container flex flex-col w-80">
                    <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#101a23] p-4">
                        <div class="flex flex-col gap-4">
                            <!-- Logo/Header -->
                            <div class="flex gap-3">
                                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold">
                                    🤖
                                </div>
                                <h1 class="text-white text-base font-medium leading-normal">AI Chief of Staff</h1>
                            </div>
                            
                            <!-- Navigation Menu -->
                            <div class="flex flex-col gap-2">
                                <a href="/home" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Home</p>
                                </a>
                                
                                <a href="/knowledge" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M224,48H160a40,40,0,0,0-32,16A40,40,0,0,0,96,48H32A16,16,0,0,0,16,64V192a16,16,0,0,0,16,16H96a24,24,0,0,1,24,24,8,8,0,0,0,16,0,24,24,0,0,1,24-24h64a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48ZM96,192H32V64H96a24,24,0,0,1,24,24V200A39.81,39.81,0,0,0,96,192Zm128,0H160a39.81,39.81,0,0,0-24,8V88a24,24,0,0,1,24-24h64Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Knowledge</p>
                                </a>
                                
                                <a href="/tasks" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M56,128a16,16,0,1,1-16-16A16,16,0,0,1,56,128ZM40,48A16,16,0,1,0,56,64,16,16,0,0,0,40,48Zm0,128a16,16,0,1,0,16,16A16,16,0,0,0,40,176Zm176-64H88a8,8,0,0,0-8,8v16a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V120A8,8,0,0,0,216,112Zm0-64H88a8,8,0,0,0-8,8V72a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V56A8,8,0,0,0,216,48Zm0,128H88a8,8,0,0,0-8,8v16a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V184A8,8,0,0,0,216,176Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Tasks</p>
                                </a>
                                
                                <a href="/people" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,1,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">People</p>
                                </a>
                                
                                <a href="/calendar" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Zm-96-88v64a8,8,0,0,1-16,0V132.94l-4.42,2.22a8,8,0,0,1-7.16-14.32l16-8A8,8,0,0,1,112,120Zm59.16,30.45L152,176h16a8,8,0,0,1,0,16H136a8,8,0,0,1-6.4-12.8l28.78-38.37A8,8,0,1,0,145.07,132a8,8,0,1,1-13.85-8A24,24,0,0,1,176,140,23.76,23.76,0,0,1,171.16,150.45Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Calendar</p>
                                </a>
                                
                                <div class="flex items-center gap-3 px-3 py-2 rounded-full bg-[#223649]">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.6,107.6,0,0,0-10.88-26.25a8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3.12-3.12l-2.64-23.72a8,8,0,0,0-3.93-6,107.89,107.89,0,0,0-26.25-10.87a8,8,0,0,0-7.06,1.49L130.16,40q-2.16-.06-4.32,0L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.48-3.12,3.12L40.48,70.03a8,8,0,0,0-6,3.93,107.89,107.89,0,0,0-10.87,26.25a8,8,0,0,0,1.49,7.06L40,125.84q-.06,2.16,0,4.32L25.11,148.8a8,8,0,0,0-1.48,7.06,107.6,107.6,0,0,0,10.88,26.25a8,8,0,0,0,6,3.93l23.72,2.64q1.48,1.56,3.12,3.12l2.64,23.72a8,8,0,0,0,3.93,6,107.89,107.89,0,0,0,26.25,10.87a8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.6,107.6,0,0,0,26.25-10.88a8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3.12-3.12L215.52,186a8,8,0,0,0,6-3.93,107.89,107.89,0,0,0,10.87-26.25a8,8,0,0,0-1.49-7.06ZM128,208a80,80,0,1,1,80-80A80.09,80.09,0,0,1,128,208Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Settings</p>
                                </div>
                                
                                <a href="/logout" class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#223649] rounded-full transition-colors">
                                    <div class="text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                            <path d="M112,216a8,8,0,0,1-8,8H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h56a8,8,0,0,1,0,16H48V208h56A8,8,0,0,1,112,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L188.69,112H104a8,8,0,0,0,0,16h84.69l-18.35,18.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,221.66,122.34Z"></path>
                                        </svg>
                                    </div>
                                    <p class="text-white text-sm font-medium leading-normal">Logout</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                    
                    <!-- Page Header -->
                    <div class="flex flex-wrap justify-between gap-3 p-4">
                        <div class="flex min-w-72 flex-col gap-3">
                            <p class="text-white tracking-light text-[32px] font-bold leading-tight">⚙️ Settings</p>
                            <p class="text-[#90aecb] text-sm font-normal leading-normal">Configure your AI Chief of Staff preferences and email sync settings</p>
                        </div>
                    </div>

                    <!-- Settings Sections -->
                    <div class="space-y-6">
                        
                        <!-- Email Sync Settings -->
                        <div class="bg-[#182734] rounded-lg border border-[#314d68] p-6">
                            <h3 class="text-white text-xl font-bold mb-4">📧 Email Sync Settings</h3>
                            <p class="text-[#90aecb] text-sm mb-6">Configure how many emails to process and trigger manual sync</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Email Fetch Limit -->
                                <div>
                                    <label class="block text-[#90aecb] text-sm font-medium mb-2">
                                        📊 Max Emails to Fetch
                                    </label>
                                    <input 
                                        id="emailFetchLimit" 
                                        type="number" 
                                        min="1" 
                                        max="500" 
                                        value="50"
                                        class="w-full p-3 bg-[#223649] text-white rounded border border-[#314d68] focus:outline-none focus:border-[#0b80ee]"
                                        placeholder="e.g., 50"
                                    >
                                    <p class="text-[#90aecb] text-xs mt-1">Number of emails to fetch in each sync (1-500)</p>
                                </div>
                                
                                <!-- Days Back -->
                                <div>
                                    <label class="block text-[#90aecb] text-sm font-medium mb-2">
                                        📅 Days Back to Fetch
                                    </label>
                                    <input 
                                        id="emailDaysBack" 
                                        type="number" 
                                        min="1" 
                                        max="365" 
                                        value="30"
                                        class="w-full p-3 bg-[#223649] text-white rounded border border-[#314d68] focus:outline-none focus:border-[#0b80ee]"
                                        placeholder="e.g., 30"
                                    >
                                    <p class="text-[#90aecb] text-xs mt-1">How many days back to search for emails (1-365)</p>
                                </div>
                            </div>
                            
                            <!-- Auto Process Toggle -->
                            <div class="mb-6">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input 
                                        id="autoProcessEmails" 
                                        type="checkbox" 
                                        class="w-5 h-5 text-[#0b80ee] bg-[#223649] border-[#314d68] rounded focus:ring-[#0b80ee] focus:ring-2"
                                    >
                                    <div>
                                        <span class="text-white font-medium">🤖 Auto-process emails with AI</span>
                                        <p class="text-[#90aecb] text-sm">Automatically analyze emails for insights, tasks, and people when syncing</p>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- Manual Sync Section -->
                            <div class="border-t border-[#314d68] pt-6">
                                <h4 class="text-white font-semibold mb-4">🔄 Manual Email Sync</h4>
                                <p class="text-[#90aecb] text-sm mb-4">Trigger an immediate email sync with custom parameters</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label class="block text-[#90aecb] text-sm mb-2">Max Emails</label>
                                        <input 
                                            id="syncMaxEmails" 
                                            type="number" 
                                            min="1" 
                                            max="500" 
                                            value="20"
                                            class="w-full p-2 bg-[#223649] text-white rounded border border-[#314d68] focus:outline-none focus:border-[#0b80ee]"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-[#90aecb] text-sm mb-2">Days Back</label>
                                        <input 
                                            id="syncDaysBack" 
                                            type="number" 
                                            min="1" 
                                            max="365" 
                                            value="7"
                                            class="w-full p-2 bg-[#223649] text-white rounded border border-[#314d68] focus:outline-none focus:border-[#0b80ee]"
                                        >
                                    </div>
                                    <div class="flex items-end">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                id="forceRefresh" 
                                                type="checkbox" 
                                                class="w-4 h-4 text-[#0b80ee] bg-[#223649] border-[#314d68] rounded focus:ring-[#0b80ee]"
                                            >
                                            <span class="text-[#90aecb] text-sm">Force refresh</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <button 
                                    id="triggerSyncBtn"
                                    onclick="triggerUnifiedSync()"
                                    class="bg-[#0b80ee] text-white px-6 py-3 rounded font-medium hover:bg-blue-600 transition-colors"
                                >
                                    🚀 Start Email + Calendar Sync
                                </button>
                                
                                <!-- Sync Progress -->
                                <div id="syncProgress" class="hidden mt-4 p-4 bg-[#223649] rounded border border-[#314d68]">
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-[#0b80ee]"></div>
                                        <span class="text-white font-medium">Syncing emails and calendar...</span>
                                    </div>
                                    <div id="syncStatus" class="text-[#90aecb] text-sm"></div>
                                </div>
                                
                                <!-- Sync Results -->
                                <div id="syncResults" class="hidden mt-4 p-4 bg-[#223649] rounded border border-[#314d68]">
                                    <h5 class="text-white font-medium mb-2">✅ Sync Complete</h5>
                                    <div id="syncSummary" class="text-[#90aecb] text-sm"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Calendar Integration Settings -->
                        <div class="bg-[#182734] rounded-lg border border-[#314d68] p-6">
                            <h3 class="text-white text-xl font-bold mb-4">📅 Calendar Integration</h3>
                            <p class="text-[#90aecb] text-sm mb-6">Sync your Google Calendar for attendee intelligence and free time analysis</p>
                            
                            <!-- Calendar Setup Status -->
                            <div id="calendarStatus" class="mb-6 p-4 bg-[#223649] rounded border border-green-600">
                                <div class="flex items-center gap-3 mb-2">
                                    <div id="calendarStatusIcon" class="text-xl">✅</div>
                                    <div>
                                        <div id="calendarStatusText" class="text-white font-medium">Calendar Integration Active</div>
                                        <div id="calendarStatusDetail" class="text-[#90aecb] text-sm">Google Calendar integration is working. Use the unified sync to fetch calendar events.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Google Cloud Console Setup Instructions -->
                            <div id="calendarSetupInstructions" class="hidden mb-6 p-4 bg-yellow-900/20 border border-yellow-600 rounded">
                                <div class="flex items-start gap-3">
                                    <div class="text-yellow-400 text-xl">⚠️</div>
                                    <div>
                                        <h4 class="text-yellow-400 font-semibold mb-2">Google Calendar API Setup Required</h4>
                                        <p class="text-yellow-300 text-sm mb-3">
                                            To enable calendar integration, you need to configure Google Calendar API in your Google Cloud Console:
                                        </p>
                                        <ol class="text-yellow-300 text-sm space-y-2 list-decimal list-inside">
                                            <li>Go to <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-400 underline">Google Cloud Console</a></li>
                                            <li>Select your existing project (the same one used for Gmail)</li>
                                            <li>Go to <strong>APIs & Services → Library</strong></li>
                                            <li>Search for "Google Calendar API" and click <strong>Enable</strong></li>
                                            <li>Go to <strong>APIs & Services → OAuth consent screen</strong></li>
                                            <li>Under <strong>Scopes</strong>, click <strong>Add or Remove Scopes</strong></li>
                                            <li>Add these scopes:
                                                <ul class="ml-4 mt-1 space-y-1 list-disc list-inside">
                                                    <li><code class="bg-gray-800 px-1 rounded">https://www.googleapis.com/auth/calendar.readonly</code></li>
                                                    <li><code class="bg-gray-800 px-1 rounded">https://www.googleapis.com/auth/gmail.readonly</code> (if not already added)</li>
                                                </ul>
                                            </li>
                                            <li>Save the changes</li>
                                            <li>Re-authenticate using the <strong>Force Logout</strong> link below to refresh permissions</li>
                                        </ol>
                                        <div class="mt-4 flex gap-2">
                                            <a href="https://console.cloud.google.com/" target="_blank" 
                                               class="inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors">
                                                🔗 Open Google Cloud Console
                                            </a>
                                            <a href="/force-logout" 
                                               class="inline-flex items-center px-3 py-2 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors">
                                                🔄 Force Logout & Re-authenticate
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Calendar Sync Controls -->
                            <div id="calendarSyncControls" class="">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <label class="block text-[#90aecb] text-sm font-medium mb-2">
                                            📅 Days Forward
                                        </label>
                                        <input 
                                            id="calendarDaysForward" 
                                            type="number" 
                                            min="1" 
                                            max="90" 
                                            value="14"
                                            class="w-full p-3 bg-[#223649] text-white rounded border border-[#314d68] focus:outline-none focus:border-[#0b80ee]"
                                            placeholder="e.g., 14"
                                        >
                                        <p class="text-[#90aecb] text-xs mt-1">Days ahead to sync calendar events (1-90)</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-[#90aecb] text-sm font-medium mb-2">
                                            📅 Days Back
                                        </label>
                                        <input 
                                            id="calendarDaysBack" 
                                            type="number" 
                                            min="1" 
                                            max="30" 
                                            value="3"
                                            class="w-full p-3 bg-[#223649] text-white rounded border border-[#314d68] focus:outline-none focus:border-[#0b80ee]"
                                            placeholder="e.g., 3"
                                        >
                                        <p class="text-[#90aecb] text-xs mt-1">Days back to sync calendar events (1-30)</p>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <label class="flex items-center gap-3 cursor-pointer">
                                        <input 
                                            id="enableAttendeeIntelligence" 
                                            type="checkbox" 
                                            checked
                                            class="w-5 h-5 text-[#0b80ee] bg-[#223649] border-[#314d68] rounded focus:ring-[#0b80ee] focus:ring-2"
                                        >
                                        <div>
                                            <span class="text-white font-medium">🧠 Enable Attendee Intelligence</span>
                                            <p class="text-[#90aecb] text-sm">Match meeting attendees with your contact database for business insights</p>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="mb-6">
                                    <label class="flex items-center gap-3 cursor-pointer">
                                        <input 
                                            id="enableFreeTimeAnalysis" 
                                            type="checkbox" 
                                            checked
                                            class="w-5 h-5 text-[#0b80ee] bg-[#223649] border-[#314d68] rounded focus:ring-[#0b80ee] focus:ring-2"
                                        >
                                        <div>
                                            <span class="text-white font-medium">⏰ Enable Free Time Analysis</span>
                                            <p class="text-[#90aecb] text-sm">AI recommendations for productive use of free time slots</p>
                                        </div>
                                    </label>
                                </div>
                                
                                <button 
                                    id="testCalendarBtn"
                                    onclick="testCalendarAccess()"
                                    class="bg-green-600 text-white px-6 py-3 rounded font-medium hover:bg-green-700 transition-colors mr-4"
                                >
                                    🔍 Test Calendar Access
                                </button>
                                
                                <button 
                                    id="syncCalendarBtn"
                                    onclick="syncCalendarOnly()"
                                    class="bg-purple-600 text-white px-6 py-3 rounded font-medium hover:bg-purple-700 transition-colors"
                                >
                                    📅 Sync Calendar Only
                                </button>
                            </div>
                        </div>
                        
                        <!-- Account Information -->
                        <div class="bg-[#182734] rounded-lg border border-[#314d68] p-6">
                            <h3 class="text-white text-xl font-bold mb-4">👤 Account Information</h3>
                            <div id="accountInfo" class="space-y-3">
                                <div class="text-[#90aecb] text-sm">Loading account information...</div>
                            </div>
                        </div>
                        
                        <!-- Database Management -->
                        <div class="bg-[#182734] rounded-lg border border-red-600 p-6">
                            <h3 class="text-white text-xl font-bold mb-4">🗄️ Database Management</h3>
                            <div class="bg-red-900/20 border border-red-600 rounded-lg p-4 mb-4">
                                <div class="flex items-start gap-3">
                                    <div class="text-red-400 text-xl">⚠️</div>
                                    <div>
                                        <h4 class="text-red-400 font-semibold mb-2">Danger Zone</h4>
                                        <p class="text-red-300 text-sm mb-3">
                                            These actions permanently delete your data and cannot be undone. 
                                            Use with extreme caution.
                                        </p>
                                        <ul class="text-red-300 text-sm space-y-1">
                                            <li>• All processed emails will be removed</li>
                                            <li>• All extracted tasks will be deleted</li>
                                            <li>• All identified people and contacts will be lost</li>
                                            <li>• All project data will be erased</li>
                                            <li>• All topics and business intelligence will be deleted</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-white font-semibold mb-2">🧹 Flush All Data</h4>
                                    <p class="text-[#90aecb] text-sm mb-4">
                                        Completely clear your database to start fresh. This will remove all emails, tasks, 
                                        people, projects, and business intelligence data but keep your account.
                                    </p>
                                    
                                    <button 
                                        id="flushDatabaseBtn"
                                        onclick="confirmFlushDatabase()"
                                        class="bg-red-600 text-white px-6 py-3 rounded font-medium hover:bg-red-700 transition-colors flex items-center gap-2"
                                    >
                                        🗑️ Flush All Database Data
                                    </button>
                                </div>
                                
                                <!-- Flush Progress -->
                                <div id="flushProgress" class="hidden p-4 bg-[#223649] rounded border border-[#314d68]">
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-red-400"></div>
                                        <span class="text-white font-medium">Flushing database...</span>
                                    </div>
                                    <div class="text-[#90aecb] text-sm">This may take a few moments...</div>
                                </div>
                                
                                <!-- Flush Results -->
                                <div id="flushResults" class="hidden p-4 bg-green-900/20 border border-green-600 rounded">
                                    <h5 class="text-green-400 font-medium mb-2">✅ Database Flushed Successfully</h5>
                                    <div class="text-green-300 text-sm">
                                        All your data has been cleared. You can now start fresh by processing new emails.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex gap-4 pt-6">
                            <button 
                                id="saveSettingsBtn"
                                onclick="saveSettings()"
                                class="bg-green-500 text-white px-6 py-3 rounded font-medium hover:bg-green-600 transition-colors"
                            >
                                💾 Save Settings
                            </button>
                            
                            <button 
                                onclick="loadSettings()"
                                class="bg-[#223649] text-[#90aecb] px-6 py-3 rounded font-medium hover:bg-[#314d68] transition-colors"
                            >
                                🔄 Reload
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Settings management
        let currentSettings = {};

        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
        });

        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                
                if (data.success) {
                    currentSettings = data.settings;
                    populateSettings(data.settings);
                    updateAccountInfo(data.settings);
                } else {
                    showError('Failed to load settings: ' + data.error);
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showError('Failed to load settings');
            }
        }

        function populateSettings(settings) {
            document.getElementById('emailFetchLimit').value = settings.email_fetch_limit || 50;
            document.getElementById('emailDaysBack').value = settings.email_days_back || 30;
            document.getElementById('autoProcessEmails').checked = settings.auto_process_emails !== false;
            
            // Set sync defaults to current settings
            document.getElementById('syncMaxEmails').value = settings.email_fetch_limit || 20;
            document.getElementById('syncDaysBack').value = Math.min(settings.email_days_back || 7, 30);
        }

        function updateAccountInfo(settings) {
            const accountInfoHtml = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <div class="text-white font-medium">📧 Email</div>
                        <div class="text-[#90aecb] text-sm">${settings.email}</div>
                    </div>
                    <div>
                        <div class="text-white font-medium">👤 Name</div>
                        <div class="text-[#90aecb] text-sm">${settings.name}</div>
                    </div>
                    <div>
                        <div class="text-white font-medium">📅 Member Since</div>
                        <div class="text-[#90aecb] text-sm">${formatDate(settings.created_at)}</div>
                    </div>
                    <div>
                        <div class="text-white font-medium">🕐 Last Login</div>
                        <div class="text-[#90aecb] text-sm">${formatDate(settings.last_login)}</div>
                    </div>
                </div>
            `;
            document.getElementById('accountInfo').innerHTML = accountInfoHtml;
        }

        async function saveSettings() {
            const btn = document.getElementById('saveSettingsBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white inline-block mr-2"></div>Saving...';
            btn.disabled = true;
            
            try {
                const settings = {
                    email_fetch_limit: parseInt(document.getElementById('emailFetchLimit').value),
                    email_days_back: parseInt(document.getElementById('emailDaysBack').value),
                    auto_process_emails: document.getElementById('autoProcessEmails').checked
                };
                
                const response = await fetch('/api/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess('✅ Settings saved successfully!');
                    currentSettings = { ...currentSettings, ...settings };
                } else {
                    showError('Failed to save settings: ' + data.error);
                }
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showError('Failed to save settings');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function triggerUnifiedSync() {
            const btn = document.getElementById('triggerSyncBtn');
            const progressDiv = document.getElementById('syncProgress');
            const resultsDiv = document.getElementById('syncResults');
            const statusDiv = document.getElementById('syncStatus');
            
            const originalText = btn.innerHTML;
            
            // UI updates
            btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white inline-block mr-2"></div>Syncing...';
            btn.disabled = true;
            progressDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            statusDiv.textContent = 'Initializing email and calendar sync...';
            
            try {
                const syncParams = {
                    max_emails: parseInt(document.getElementById('syncMaxEmails').value),
                    days_back: parseInt(document.getElementById('syncDaysBack').value),
                    force_refresh: document.getElementById('forceRefresh').checked
                };
                
                statusDiv.textContent = `Fetching ${syncParams.max_emails} emails from last ${syncParams.days_back} days...`;
                
                const response = await fetch('/api/trigger-email-sync', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(syncParams)
                });
                
                const data = await response.json();
                
                progressDiv.classList.add('hidden');
                
                if (data.success) {
                    // Show success results
                    const summary = data.summary;
                    const summaryHtml = `
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>📧 Emails fetched: <span class="text-white font-medium">${summary.emails_fetched}</span></div>
                            <div>🔍 Emails analyzed: <span class="text-white font-medium">${summary.emails_analyzed}</span></div>
                            <div>💡 Insights extracted: <span class="text-white font-medium">${summary.insights_extracted}</span></div>
                            <div>👥 People identified: <span class="text-white font-medium">${summary.people_identified}</span></div>
                            <div>📋 Projects identified: <span class="text-white font-medium">${summary.projects_identified}</span></div>
                            <div>✅ Tasks created: <span class="text-white font-medium">${summary.tasks_created}</span></div>
                            <div>📊 Total emails: <span class="text-white font-medium">${summary.total_emails}</span></div>
                            <div>🎯 Total tasks: <span class="text-white font-medium">${summary.total_tasks}</span></div>
                        </div>
                    `;
                    document.getElementById('syncSummary').innerHTML = summaryHtml;
                    resultsDiv.classList.remove('hidden');
                    
                    showSuccess(`🎉 Successfully synced ${summary.emails_fetched} emails and ${summary.people_identified} people!`);
                } else {
                    showError('Sync failed: ' + data.error);
                }
                
            } catch (error) {
                console.error('Error triggering sync:', error);
                progressDiv.classList.add('hidden');
                showError('Failed to trigger email and calendar sync');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Database flush functionality
        function confirmFlushDatabase() {
            // First confirmation - general warning
            const firstConfirm = confirm(
                "⚠️ WARNING: This will permanently delete ALL your AI Chief of Staff data!\n\n" +
                "This includes:\n" +
                "• All processed emails\n" +
                "• All extracted tasks\n" +
                "• All identified people and contacts\n" +
                "• All project data\n" +
                "• All topics and business intelligence\n\n" +
                "Are you absolutely sure you want to continue?"
            );
            
            if (!firstConfirm) return;
            
            // Second confirmation - type confirmation
            const typeConfirm = prompt(
                "🚨 FINAL WARNING 🚨\n\n" +
                "This action is IRREVERSIBLE and will delete ALL your data!\n\n" +
                "To confirm, type exactly: DELETE ALL MY DATA"
            );
            
            if (typeConfirm !== "DELETE ALL MY DATA") {
                alert("❌ Confirmation text did not match. Database flush cancelled.");
                return;
            }
            
            // Third confirmation - are you really sure
            const finalConfirm = confirm(
                "🔥 LAST CHANCE 🔥\n\n" +
                "You are about to permanently delete ALL your AI Chief of Staff data.\n" +
                "This cannot be undone.\n\n" +
                "Click OK to proceed with complete data deletion.\n" +
                "Click Cancel to abort this operation."
            );
            
            if (!finalConfirm) {
                alert("✅ Database flush cancelled. Your data is safe.");
                return;
            }
            
            // All confirmations passed - proceed with flush
            flushDatabase();
        }

        async function flushDatabase() {
            const btn = document.getElementById('flushDatabaseBtn');
            const progressDiv = document.getElementById('flushProgress');
            const resultsDiv = document.getElementById('flushResults');
            
            const originalText = btn.innerHTML;
            
            // UI updates
            btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white inline-block mr-2"></div>Flushing...';
            btn.disabled = true;
            progressDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            
            try {
                const response = await fetch('/api/flush-database', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                progressDiv.classList.add('hidden');
                
                if (data.success) {
                    // Show success results
                    resultsDiv.classList.remove('hidden');
                    showSuccess('🎉 Database flushed successfully! All data has been cleared. You can now start fresh.');
                } else {
                    showError('Database flush failed: ' + data.error);
                }
                
            } catch (error) {
                console.error('Error flushing database:', error);
                progressDiv.classList.add('hidden');
                showError('Failed to flush database: ' + error.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'Never';
            try {
                return new Date(dateString).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch {
                return 'Invalid date';
            }
        }

        function showSuccess(message) {
            alert(message);
        }

        function showError(message) {
            alert('❌ ' + message);
        }

        // Calendar integration functions
        async function testCalendarAccess() {
            const btn = document.getElementById('testCalendarBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white inline-block mr-2"></div>Testing...';
            btn.disabled = true;
            
            try {
                const response = await fetch('/api/fetch-calendar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        days_back: 1,
                        days_forward: 7,
                        limit: 5
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess(`✅ Calendar access successful! Found ${data.count || 0} events.`);
                } else {
                    showError(`❌ Calendar access failed: ${data.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Calendar test error:', error);
                showError('❌ Calendar test failed. Check your Google Calendar API setup.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function syncCalendarOnly() {
            const btn = document.getElementById('syncCalendarBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white inline-block mr-2"></div>Syncing...';
            btn.disabled = true;
            
            try {
                const daysForward = parseInt(document.getElementById('calendarDaysForward').value) || 14;
                const daysBack = parseInt(document.getElementById('calendarDaysBack').value) || 3;
                
                const response = await fetch('/api/fetch-calendar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        days_back: daysBack,
                        days_forward: daysForward,
                        force_refresh: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess(`🎉 Calendar sync complete! Synced ${data.count || 0} events.`);
                    
                    // Trigger free time analysis if enabled
                    if (document.getElementById('enableFreeTimeAnalysis').checked) {
                        const freeTimeResponse = await fetch('/api/free-time-analysis', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                days_forward: daysForward
                            })
                        });
                        
                        const freeTimeData = await freeTimeResponse.json();
                        if (freeTimeData.success) {
                            const freeSlots = freeTimeData.free_slots || [];
                            showSuccess(`⏰ Found ${freeSlots.length} free time slots for productivity recommendations!`);
                        }
                    }
                } else {
                    showError(`❌ Calendar sync failed: ${data.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Calendar sync error:', error);
                showError('❌ Calendar sync failed. Check your setup.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html> 